
Release code of SteerConf



## Code Overview

To evaluate the uncertainty estimation ability of a method on a given dataset and model, we need to go through the following three steps:

1. `prompt_xx.py`: This script is used to prompt the Language Model (LLM) to generate corresponding responses. 

2. `extract_xx.py`: This script is used to extract the predicted answers of LLMs from the processed file generated by `prompt_xx.py`.

3. `vis_xx.py`: This script is used to visualize the output distribution based on the processed file generated by `extract_xxx.sh` and evaluate the performance of the entire dataset and obtain dataset-level metrics, such as Expected Calibration Error (ECE) and Area Under the Receiver Operating Characteristic Curve (AUROC).

- Prompt Strategy: 
  - prompt = `vanilla` or  `CoT` -> use `query_vanilla_or_cot.py`
  - prompt = `multistep` -> use `query_multistep.py`
  - prompt = `Top-K` -> consider `query_top_k.py`
  - prompt = `self_probing` -> consider `query_self_probing.py`

- Sampling Strategy:
  - `self_random` sampling which replies on model internal randomness: setting the `sampling_type` in `prompt_xx.py` to be `self_random`
  - `misleading` sampling which replies on input misleading hints as introduced noise: setting the `sampling_type` in `prompt_xx.py` to be `misleading`

- Aggregation Strategy:
  - all supported aggregation has been implemented in corresponding `vis_xx.py` scripts



# How to run SteerConf 

Put your API key in `api_key.txt`, and change the "base_site" in `llm_query_helper.py` to the base site of your LLM provider.


## Query in different steering directions and levels (take Llama-3.3-70b-instruct with CoT as an example)

python scripts/20241209_confidence_after_answer_important_decisions_llama.py 

## Aggregate results

python scripts/20241209_result_aggregate.py --cot "cot" --model Llama-3.3-70b-instruct --datasets_list "0123456" --dates "02-02-14-49"

## Visualization and evaluation

bash scripts/20241209_confidence_after_answer_important_decisions_llama_summarized.sh


